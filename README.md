# LuoguDiscussMarker 洛谷讨论标记器

Luogu Discuss Marker（下简称 LDM，中文名称“洛谷讨论标记器”）是一个用于标记洛谷讨论以便用户更轻松地使用社区功能的用户脚本。本项目目前由 ForkKILLET 维护。

## 安装用户脚本

0. 需要浏览器安装 [TamperMonkey（油猴）](http://www.tampermonkey.net/) 插件，具体步骤可自行查阅相关资料。
1. 新建脚本，导入本项目中 LDM.js 的脚本代码并保存。
2. 至此，安装工作已经完成。如果没有效果，请先尝试自行检查：
   - 浏览器版本是否为最新；（脚本中使用了部分新特性，需要现代浏览器支持）
   - TamperMonkey 插件是否启用；
   - LDM 脚本是否已经启用。

## 使用方法

LDM 使用“标记”的概念来维护某个讨论的状态，这里的“标记”既可以是动词也可以是名词。作为使用者，你可以用特定格式（称为 LDM 标记格式）回复讨论来为这个讨论设置标记；同时，LDM 会自动读取现有的标记并进行渲染（读取时将暂时显示“分析中”）。任何使用者都可以为讨论设置标记，但我们希望你能够遵循以下规则：

- 客观公正。你的标记数据将被所有使用者共享，这意味着带有主观倾向的标记可能会产生极大误导。任何标记的设置都应该首先遵循客观公正的原则，这同时也有助于你的使用体验。
- 认真负责。当你设置标记时，你实际上是在为整个 LDM 用户社区服务，认真负责的态度是心智健全者的必备素质。

任何违反规则的滥用行为都将以信任值的扣除为代价。

一个标记的通式是：  

```plain
< {mark-name}: {reason} >
```

对于新手，这可能不太容易理解。例如，若要标记“无意义”，则完整的标记是（每行都是一个合法的完整标记，效果相同）：

```plain
< 无意义：洛谷社区帮助中有提及，不应在讨论区中询问。 >
< Useless: 洛谷社区帮助中有提及，不应在讨论区中询问。 >
<usl:洛谷社区帮助中有提及，不应在讨论区中询问。>
```

目前所有可用的标记名称（`{mark-name}`）将在稍后列表给出。通过上例可以看出，标记中空格是不限的，全半角冒号均可使用。同一条回复中可以存在多个不同种类的标记，但同一个人多次设置同类型标记是不被允许的。

当脚本成功匹配到一个完整的标记，将会立即对其进行分析。`{reason}`，是原因部分，根据标记类型的不同有不同的规定字数下限，这很显然——设置标记时需要同时给出合适的原因，这也是“认真负责”规则的要求。

众所周知，任何限制措施都存在不同程度的突破方法，但我们**禁止任何违反“可观公正”和“认真负责”两大规则的滥用行为**。对于恶意标记者，将扣除其信任值作为惩罚。

信任值将参与标记权重的计算。具体公式为：

```javascript
weight = trust * (1.3 ** v_level) * (root ? 1.5 : 1) * (now_root ? 1.5 : 1)
```

其中，`v_level` 为认证等级。无勾、绿勾、蓝勾、金钩分别对应其 0 ~ 3 的值。`root` 代表此人是或曾是管理员，`now_root` 代表此人目前正担任管理员的职位。

权重将被累加。在分析完整篇讨论后，会将权重总和与达标线进行比较，不低于达标线即被认可。

此外，各个标记对用户类别，认证等级下限还有限制，对原因长度的限制也不同。下表中展示了所有详细信息。

| 标记名称与别名 | 原因长度下限 | 用户类型限制 | 勾与管理 | 权重达标线 |
| :----------- | :----------- | :----------- | :----------- | :----------- |
| `ldm, 谷论标, glb, 洛谷讨论标记器, LuoguDiscussMarker` | 1 | 仅允许 LDM 开发组 | 不限 | 1 |
| `usl, 无意义, wyy, 无意义的内容, Useless` | 10 | 除楼主外 | 不限 | 33 |
| `mlt, 屑标题, xbt, 人间之屑标题, MeaninglessTitle` | 10 | 除楼主外 | 不限 | 20 |
| `pdt, 板漂学, bpx, 板块漂移学说, PlateDriftTheory` | 10 | 除楼主外 | 不限 | 20 |
| `usf, 有帮助, ybz, 能帮助到我, Useful` | 15 | 除楼主外 | 绿勾以上 | 43 |
| `end, 已完结, ywj, 可以来考古了, Enderman` | 20 | 仅允许楼主与管理员 | 不限 | 1 |
| `god, 是神贴, sst, 愣着干嘛留名啊, HotContent` | 25 | 除楼主外 | 蓝勾以上或管理 | 33 |

这只是暂定方案，我们欢迎一切建议（可通过 issue 提出），但请详细说明理由。

最后，经过重重筛选的标签，将会取代“分析中”呈现在讨论列表上。这可能需要几秒钟的时间；如果帖子很长，则耗时将会更多。在接下来的版本中，此问题可能得到优化。

## 更新日志

已发布

- `alpha 0`: 最初公测版，仅有标记功能，或许会有 bug，欢迎提出。

开发中

- `alpha 1`: 将支持标记的筛选，设置的导入和导出，并优化分析时间。
- `alpha 2`: 将支持 Markdown 代码框中的 Intellisense，标记高亮，标记冲突的手动判断，和与之关联的标记格式补全。

## 许可协议

本项目遵循 MIT 协议进行许可。
